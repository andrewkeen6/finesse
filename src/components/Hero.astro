---
import { contact } from '../data/siteConfig';
---

<section class="hero">
  <div class="container">
    <div class="hero-content">
      <div class="hero-media-wrapper">
        <div class="media-item active" data-type="video">
          <video muted playsinline preload="none" class="hero-video">
            <source src="/gallery/full/2025-12-18_Porsche_IMG_8981.mov" type="video/quicktime">
          </video>
        </div>
        <div class="media-item" data-type="video">
          <video muted playsinline preload="none" class="hero-video">
            <source src="/gallery/full/2025-12-18_Mercedes_IMG_7752.mov" type="video/quicktime">
          </video>
        </div>
        <div class="media-item" data-type="video">
          <video muted playsinline preload="none" class="hero-video">
            <source src="/gallery/full/2025-12-18_IMG_5646.mov" type="video/quicktime">
          </video>
        </div>
        <div class="media-item" data-type="image">
          <img loading="lazy" src="/gallery/full/2022-08-11_IMG_2976.heic" alt="Car detailing" class="hero-video">
        </div>
        <div class="media-item" data-type="video">
          <video muted playsinline preload="none" class="hero-video">
            <source src="/gallery/full/2025-12-18_IMG_9292.mov" type="video/quicktime">
          </video>
        </div>
        <div class="media-item" data-type="video">
          <video muted playsinline preload="none" class="hero-video">
            <source src="/gallery/full/2025-12-18_IMG_7136.mov" type="video/quicktime">
          </video>
        </div>
        <div class="media-item" data-type="video">
          <video muted playsinline preload="none" class="hero-video">
            <source src="/gallery/full/2025-12-18_IMG_5906.mov" type="video/quicktime">
          </video>
        </div>
        <div class="media-item" data-type="image">
          <img loading="lazy" src="/gallery/full/2023-08-02_1963BE29-5E39-4093-BF3E-0E67C0DC0ACE.HEIC" alt="Car detailing" class="hero-video">
        </div>
        <div class="media-item" data-type="video">
          <video muted playsinline preload="none" class="hero-video">
            <source src="/gallery/full/2025-12-18_IMG_4774.mov" type="video/quicktime">
          </video>
        </div>
        <div class="media-item" data-type="video">
          <video muted playsinline preload="none" class="hero-video">
            <source src="/gallery/full/2025-12-18_IMG_4462.mov" type="video/quicktime">
          </video>
        </div>
        <div class="media-item" data-type="image">
          <img loading="lazy" src="/gallery/full/2023-11-26_IMG_1089.heic" alt="Car detailing" class="hero-video">
        </div>
        <div class="media-item" data-type="video">
          <video muted playsinline preload="none" class="hero-video">
            <source src="/gallery/full/2025-12-18_IMG_1087.mov" type="video/quicktime">
          </video>
        </div>
        <div class="media-item" data-type="video">
          <video muted playsinline preload="none" class="hero-video">
            <source src="/gallery/full/2025-12-18_IMG_0950.mov" type="video/quicktime">
          </video>
        </div>
        <div class="media-item" data-type="image">
          <img loading="lazy" src="/gallery/full/2024-03-29_IMG_3919.heic" alt="Car detailing" class="hero-video">
        </div>
        <div class="media-item" data-type="image">
          <img loading="lazy" src="/gallery/full/2024-05-07_IMG_4713.jpeg" alt="Car detailing" class="hero-video">
        </div>
        <div class="media-item" data-type="video">
          <video muted playsinline preload="none" class="hero-video">
            <source src="/gallery/full/2025-12-18_7276c61fa0ab4b82883252e5687d4bc6.mov" type="video/quicktime">
          </video>
        </div>
        <div class="media-item" data-type="video">
          <video muted playsinline preload="none" class="hero-video">
            <source src="/gallery/full/2025-12-18_547045ef91af4ca6adff88bb18fb9d05.mov" type="video/quicktime">
          </video>
        </div>
        <div class="media-item" data-type="video">
          <video muted playsinline preload="none" class="hero-video">
            <source src="/gallery/full/2025-12-30_66795073197__A1442FCB-66EF-40E3-99AE-4F324EDD82A0.mov" type="video/quicktime">
          </video>
        </div>
        <div class="media-item" data-type="image">
          <img loading="lazy" src="/gallery/full/2025-10-22_IMG_3446.jpeg" alt="Car detailing" class="hero-video">
        </div>
        <div class="media-item" data-type="image">
          <img loading="lazy" src="/gallery/full/2025-11-17-IMG_7347.HEIC" alt="Car detailing" class="hero-video">
        </div>
        <button class="carousel-arrow carousel-prev" aria-label="Previous">&#8249;</button>
        <button class="carousel-arrow carousel-next" aria-label="Next">&#8250;</button>
        <div class="carousel-loader">
          <img src="/logo.png" alt="Loading" class="carousel-loader-logo" />
          <div class="carousel-loader-bar">
            <div class="carousel-loader-progress"></div>
          </div>
        </div>
        <div class="carousel-indicators">
          <button class="indicator active" data-index="0"></button>
          <button class="indicator" data-index="1"></button>
          <button class="indicator" data-index="2"></button>
          <button class="indicator" data-index="3"></button>
          <button class="indicator" data-index="4"></button>
          <button class="indicator" data-index="5"></button>
          <button class="indicator" data-index="6"></button>
          <button class="indicator" data-index="7"></button>
          <button class="indicator" data-index="8"></button>
          <button class="indicator" data-index="9"></button>
          <button class="indicator" data-index="10"></button>
          <button class="indicator" data-index="11"></button>
          <button class="indicator" data-index="12"></button>
          <button class="indicator" data-index="13"></button>
          <button class="indicator" data-index="14"></button>
          <button class="indicator" data-index="15"></button>
          <button class="indicator" data-index="16"></button>
          <button class="indicator" data-index="17"></button>
          <button class="indicator" data-index="18"></button>
        </div>
      </div>

      <div class="hero-text-card" data-parallax="0.05">
        <h1 class="hero-title">
          Fine Motorcar & Marine Detailing
          <span class="highlight">with Finèsse</span>
        </h1>
        <p class="hero-subtitle">
          Transform your vehicle or boat with our professional detailing services. We restore, protect, and enhance your car's or marine vessel's appearance with meticulous attention to detail.
        </p>
        <div class="hero-actions">
          <a href={contact.phone.href} class="btn btn-primary">Call Now</a>
          <a href="/gallery" class="btn btn-outline-white">View Our Work</a>
        </div>
        <div class="hero-features">
          <div class="feature">
            <svg class="feature-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></svg>
            <span>Premium Quality</span>
          </div>
          <div class="feature">
            <svg class="feature-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/><path d="m9 12 2 2 4-4"/></svg>
            <span>Fully Insured</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<style>
  .hero {
    background: var(--black);
    padding: 1.5rem 0;
    min-height: auto;
    display: flex;
    align-items: center;
  }

  .hero-content {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
    width: 100%;
  }

  /* Mobile-first: Media carousel on top */
  .hero-media-wrapper {
    width: 100%;
    border-radius: 15px;
    overflow: hidden;
    box-shadow: 0 10px 40px rgba(140, 43, 43, 0.3);
    position: relative;
    height: 350px;
    background: var(--dark-gray);
    display: block;
    cursor: pointer;
  }

  .hero-media-wrapper.paused::after {
    content: '❚❚';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 3rem;
    color: white;
    opacity: 0.7;
    pointer-events: none;
    text-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
  }

  .carousel-loader {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 5;
    display: none;
    flex-direction: column;
    align-items: center;
    gap: 1rem;
    pointer-events: none;
  }

  .hero-media-wrapper.loading .carousel-loader {
    display: flex;
  }

  .carousel-loader-logo {
    width: 80px;
    height: auto;
    opacity: 0.9;
    filter: drop-shadow(0 2px 10px rgba(0, 0, 0, 0.5));
  }

  .carousel-loader-bar {
    width: 120px;
    height: 3px;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 3px;
    overflow: hidden;
  }

  .carousel-loader-progress {
    width: 40%;
    height: 100%;
    background: var(--primary-red);
    border-radius: 3px;
    animation: loader-progress 1.2s ease-in-out infinite;
  }

  @keyframes loader-progress {
    0% { transform: translateX(-100%); }
    50% { transform: translateX(150%); }
    100% { transform: translateX(350%); }
  }

  .media-item {
    width: 100%;
    height: 100%;
    display: none;
    position: absolute;
    top: 0;
    left: 0;
  }

  .media-item.active {
    display: block;
  }

  .hero-video {
    width: 100%;
    height: 100%;
    display: block;
    object-fit: cover;
  }

  .media-item img {
    width: 100%;
    height: 100%;
    display: block;
    object-fit: cover;
  }

  .carousel-arrow {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background: rgba(0, 0, 0, 0.4);
    color: white;
    border: none;
    width: 36px;
    height: 36px;
    min-width: 36px;
    min-height: 36px;
    border-radius: 50%;
    font-size: 1.5rem;
    font-weight: 300;
    cursor: pointer;
    z-index: 10;
    opacity: 0.5;
    transition: opacity 0.3s ease, background 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    line-height: 0;
    padding: 0;
    text-align: center;
  }

  .carousel-arrow:hover,
  .carousel-arrow:active {
    opacity: 1;
    background: rgba(140, 43, 43, 0.8);
  }

  .carousel-prev {
    left: 0.5rem;
    padding-right: 3px;
  }

  .carousel-next {
    right: 0.5rem;
    padding-left: 3px;
  }

  /* Desktop: arrows hidden until hover */
  @media (min-width: 768px) {
    .carousel-arrow {
      width: 44px;
      height: 44px;
      min-width: 44px;
      min-height: 44px;
      font-size: 1.75rem;
      opacity: 0;
    }

    .hero-media-wrapper:hover .carousel-arrow {
      opacity: 0.7;
    }

    .carousel-prev {
      left: 0.75rem;
    }

    .carousel-next {
      right: 0.75rem;
    }
  }

  .carousel-indicators {
    position: absolute;
    bottom: 0.5rem;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 0.25rem;
    z-index: 10;
    flex-wrap: nowrap;
    justify-content: center;
    max-width: 95%;
    overflow-x: auto;
    padding: 0.25rem 0.5rem;
    scrollbar-width: none;
  }

  .carousel-indicators::-webkit-scrollbar {
    display: none;
  }

  .indicator {
    width: 6px;
    height: 6px;
    border-radius: 50%;
    border: none;
    background: rgba(255, 255, 255, 0.5);
    cursor: pointer;
    transition: all 0.3s ease;
    padding: 0;
    flex-shrink: 0;
  }

  .indicator.active {
    background: var(--primary-red);
    transform: scale(1.4);
  }

  .indicator:hover {
    background: rgba(255, 255, 255, 0.8);
  }

  /* Text content - floating style */
  .hero-text-card {
    padding: 1.5rem 0;
  }

  .hero-title {
    font-size: 1.75rem;
    font-weight: 800;
    line-height: 1.05;
    margin-bottom: 1rem;
    color: var(--white);
    text-shadow: 0 2px 20px rgba(0, 0, 0, 0.5);
  }

  .highlight {
    color: var(--primary-red);
    display: block;
    background: linear-gradient(135deg, var(--primary-red) 0%, #ff4444 50%, var(--dark-red) 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    filter: drop-shadow(0 2px 10px rgba(140, 43, 43, 0.4));
  }

  .hero-subtitle {
    font-size: 1rem;
    color: rgba(255, 255, 255, 0.85);
    margin-bottom: 1.5rem;
    line-height: 1.6;
    text-shadow: 0 1px 10px rgba(0, 0, 0, 0.3);
  }

  .hero-actions {
    display: flex;
    gap: 0.875rem;
    margin-bottom: 1.5rem;
    flex-direction: column;
  }

  .hero-actions .btn {
    width: 100%;
    padding: 0.875rem 1.5rem;
    font-size: 1rem;
    font-weight: 600;
    text-align: center;
    white-space: nowrap;
  }

  .btn-outline-white {
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(10px);
    color: var(--white);
    border: 2px solid rgba(255, 255, 255, 0.8);
  }

  .btn-outline-white:hover {
    background: var(--white);
    color: var(--black);
    transform: translateY(-2px);
  }

  .hero-features {
    display: flex;
    gap: 0.75rem;
    flex-wrap: wrap;
    justify-content: center;
  }

  .feature {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: rgba(255, 255, 255, 0.95);
    font-weight: 600;
    font-size: 0.85rem;
    background: rgba(140, 43, 43, 0.2);
    border: 1px solid rgba(140, 43, 43, 0.4);
    padding: 0.5rem 0.875rem;
    border-radius: 20px;
    backdrop-filter: blur(8px);
  }

  .feature-icon {
    width: 18px;
    height: 18px;
    flex-shrink: 0;
    color: var(--primary-red);
  }

  .feature-icon.star {
    color: #F59E0B;
  }

  /* Tablet and up: Side by side */
  @media (min-width: 768px) {
    .hero-content {
      flex-direction: row;
      align-items: stretch;
      gap: 2.5rem;
    }

    .hero-media-wrapper {
      flex: 1;
      max-width: 50%;
      height: 450px;
    }

    .hero-video {
      height: 100%;
    }

    .hero-text-card {
      flex: 1;
      padding: 2rem 0;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    .hero-title {
      font-size: 2.5rem;
    }

    .hero-subtitle {
      font-size: 1.1rem;
    }

    .hero-actions {
      flex-direction: row;
      justify-content: flex-start;
    }

    .hero-actions .btn {
      width: auto;
      flex: 0 0 auto;
      min-width: 160px;
    }

    .hero-features {
      justify-content: flex-start;
    }
  }

  /* Desktop: Larger layout */
  @media (min-width: 1024px) {
    .hero {
      padding: 2rem 0;
    }

    .hero-content {
      gap: 2.5rem;
      align-items: stretch;
    }

    .hero-media-wrapper {
      height: 500px;
    }

    .hero-text-card {
      padding: 2rem 0;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    .hero-title {
      font-size: 3.25rem;
      margin-bottom: 1.5rem;
    }

    .hero-subtitle {
      font-size: 1.2rem;
      margin-bottom: 2rem;
    }

    .hero-actions {
      margin-bottom: 2rem;
      gap: 1rem;
    }

    .hero-features {
      gap: 2rem;
    }

    .feature {
      font-size: 1rem;
    }
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const mediaWrapper = document.querySelector('.hero-media-wrapper');
    const indicatorsContainer = document.querySelector('.carousel-indicators');

    // Get all media items and shuffle them
    const mediaItemsArray = Array.from(document.querySelectorAll('.media-item')) as HTMLElement[];

    // Fisher-Yates shuffle algorithm
    for (let i = mediaItemsArray.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [mediaItemsArray[i], mediaItemsArray[j]] = [mediaItemsArray[j], mediaItemsArray[i]];
    }

    // Ensure first item is always an image (faster to load)
    const firstImageIndex = mediaItemsArray.findIndex(item => item.getAttribute('data-type') === 'image');
    if (firstImageIndex > 0) {
      // Swap first image with first item
      [mediaItemsArray[0], mediaItemsArray[firstImageIndex]] = [mediaItemsArray[firstImageIndex], mediaItemsArray[0]];
    }

    // Re-append shuffled items to the DOM
    mediaItemsArray.forEach((item, index) => {
      item.classList.remove('active');
      if (index === 0) {
        item.classList.add('active');
      }
      if (mediaWrapper && indicatorsContainer) {
        mediaWrapper.insertBefore(item, indicatorsContainer);
      }
    });

    const mediaItems = document.querySelectorAll('.media-item') as NodeListOf<HTMLElement>;
    const indicators = document.querySelectorAll('.indicator') as NodeListOf<HTMLButtonElement>;
    let currentIndex = 0;
    let imageTimer: number | null = null;
    let isPaused = false;

    function showMedia(index: number) {
      // Clear any existing image timer
      if (imageTimer) {
        clearTimeout(imageTimer);
        imageTimer = null;
      }

      // Hide all media items, stop videos, and deactivate indicators
      mediaItems.forEach((item, i) => {
        item.classList.remove('active');
        if (indicators[i]) {
          indicators[i].classList.remove('active');
        }
        // Stop any playing videos
        const video = item.querySelector('video') as HTMLVideoElement;
        if (video) {
          video.pause();
          video.onended = null;
        }
      });

      // Show current media item and activate indicator
      if (mediaItems[index]) {
        mediaItems[index].classList.add('active');
      }
      if (indicators[index]) {
        indicators[index].classList.add('active');
      }

      // Get the media item type
      const mediaItem = mediaItems[index];
      if (!mediaItem) {
        return;
      }

      const mediaType = mediaItem.getAttribute('data-type');

      if (mediaType === 'video') {
        const video = mediaItem.querySelector('video') as HTMLVideoElement;
        if (video) {
          const thisIndex = index;

          // Clear any previous event listeners
          video.onended = null;

          // Load the video if not already loaded
          if (video.preload === 'none') {
            video.preload = 'auto';
            video.load();
          }

          video.playbackRate = 0.75; // Slow down to 75% speed
          video.currentTime = 0;

          // Show loading indicator if video not ready
          if (video.readyState < 3) {
            mediaWrapper?.classList.add('loading');
          }

          // Wait for video to be ready to play
          const playVideo = () => {
            // Hide loading indicator
            mediaWrapper?.classList.remove('loading');

            // Only play if we're still on this item and not paused
            if (currentIndex === thisIndex && !isPaused) {
              video.play().catch(() => {
                // If video fails to play, advance after 4 seconds like an image
                imageTimer = window.setTimeout(() => {
                  if (currentIndex === thisIndex && !isPaused) {
                    nextMedia();
                  }
                }, 4000);
              });
            }
          };

          if (video.readyState >= 3) {
            playVideo();
          } else {
            video.addEventListener('canplay', playVideo, { once: true });
          }

          // Listen for video end to advance to next slide
          video.onended = () => {
            if (currentIndex === thisIndex && !isPaused) {
              nextMedia();
            }
          };
        }
      } else if (mediaType === 'image') {
        // Hide loading indicator for images
        mediaWrapper?.classList.remove('loading');

        // For images, show for 4 seconds then advance
        const thisIndex = index;
        if (!isPaused) {
          imageTimer = window.setTimeout(() => {
            // Only advance if we're still on the same image and not paused
            if (currentIndex === thisIndex && !isPaused) {
              nextMedia();
            }
          }, 4000);
        }
      }

      // Preload next 2 items
      for (let i = 1; i <= 2; i++) {
        const preloadIndex = (index + i) % mediaItems.length;
        const preloadItem = mediaItems[preloadIndex];
        if (preloadItem?.getAttribute('data-type') === 'video') {
          const preloadVideo = preloadItem.querySelector('video') as HTMLVideoElement;
          if (preloadVideo && preloadVideo.preload === 'none') {
            preloadVideo.preload = 'auto';
            preloadVideo.load();
          }
        }
      }
    }

    function nextMedia() {
      currentIndex = (currentIndex + 1) % mediaItems.length;
      showMedia(currentIndex);
    }

    function prevMedia() {
      currentIndex = (currentIndex - 1 + mediaItems.length) % mediaItems.length;
      showMedia(currentIndex);
    }

    // Add click handlers to indicators
    indicators.forEach((indicator, index) => {
      indicator.addEventListener('click', () => {
        currentIndex = index;
        showMedia(currentIndex);
      });
    });

    // Add click handlers to arrows
    const prevBtn = document.querySelector('.carousel-prev');
    const nextBtn = document.querySelector('.carousel-next');

    prevBtn?.addEventListener('click', () => {
      prevMedia();
    });

    nextBtn?.addEventListener('click', () => {
      nextMedia();
    });

    // Pause/resume on click
    mediaWrapper?.addEventListener('click', (e) => {
      // Don't toggle if clicking on arrows or indicators
      const target = e.target as HTMLElement;
      if (target.closest('.carousel-arrow') || target.closest('.carousel-indicators')) {
        return;
      }

      isPaused = !isPaused;
      mediaWrapper?.classList.toggle('paused', isPaused);
      const currentItem = mediaItems[currentIndex];
      const video = currentItem?.querySelector('video') as HTMLVideoElement;

      if (isPaused) {
        // Pause
        if (imageTimer) {
          clearTimeout(imageTimer);
          imageTimer = null;
        }
        if (video) {
          video.pause();
        }
      } else {
        // Resume
        if (video) {
          video.play().catch(() => {});
        } else {
          // It's an image, restart the timer
          const thisIndex = currentIndex;
          imageTimer = window.setTimeout(() => {
            if (currentIndex === thisIndex && !isPaused) {
              nextMedia();
            }
          }, 4000);
        }
      }
    });

    // Start the carousel
    showMedia(0);
  });
</script>